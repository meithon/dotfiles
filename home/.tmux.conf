# # List of plugins
# set -g @plugin 'tmux-plugins/tpm'
# set -g @plugin 'tmux-plugins/tmux-sensible'
# set-option -g @plugin 'b0o/tmux-autoreload'
# # deps: https://github.com/eradman/entr
# set -g @plugin 'laktak/extrakto'
# set -g @extrakto_insert_key "enter"  # use enter to insert selection
#
# set -g @plugin 'tmux-plugins/tmux-copycat'
# # set -g @plugin 'addisonlynch/tmux-sidebar-plus'
#
# # set -g @treemux-tree-nvim-init-file '~/.tmux/plugins/treemux/configs/treemux_init.lua'
# # set -g @plugin 'kiyoon/treemux'
#
# # Other examples:
# # set -g @plugin 'github_username/plugin_name'
# # set -g @plugin 'github_username/plugin_name#branch'
# # set -g @plugin 'git@github.com:user/plugin'
# # set -g @plugin 'git@bitbucket.com:user/plugin'
#
#
# setw -g window-active-style fg='#ebedef'
# setw -g window-style fg='#a6a6a6'
#
#
# # prefixã‚­ãƒ¼ã‚’C-aã«å¤‰æ›´
# set -g prefix C-s
# # C-bã®ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒ‰ã‚’è§£é™¤
# unbind C-b
#
# # Copy mode
# setw -g mode-keys vi
#
# bind a setw synchronize-panes \; display "synchronize-panes #{?pane_synchronized,on,off}"
#
#
# # prefix+\ã§ãƒšã‚¤ãƒ³ã‚’å‚ç›´åˆ†å‰²ã™ã‚‹
# bind v split-window -h
#
# # prefix+-ã§ãƒšã‚¤ãƒ³ã‚’æ°´å¹³åˆ†å‰²ã™ã‚‹
# bind s split-window -v
#
# unbind o
# unbind i
# # ãƒšã‚¤ãƒ³ã‚’ãƒªã‚µã‚¤ã‚ºã™ã‚‹
# bind -r y resize-pane -L 18
# bind -r u resize-pane -D 12
# bind -r i resize-pane -U 13
# bind -r o resize-pane -R 18
#
# unbind L
# bind-key H swap-pane -U
# bind-key L swap-pane -D
#
# bind-key r rotate-window
# bijd-key R rotate-window -D
#
# bind-key N swap-window -t +1\; select-window -t +1
# bind-key P swap-window -t 0\; select-window -t -1
#
# # ãƒšã‚¤ãƒ³ã‚’æœ€å¤§åŒ–ã™ã‚‹
# bind -n C-z resize-pane -Z
#
# # 256è‰²ãƒ¢ãƒ¼ãƒ‰ã‚’æœ‰åŠ¹ã«ã™ã‚‹
# set-option -g default-terminal "screen-256color"
#
# set -ag terminal-overrides ",xterm-256color:Tc"
# # Undercurl
# set -as terminal-overrides ',*:Smulx=\E[4::%p1%dm'  # undercurl support
# set -as terminal-overrides ',*:Setulc=\E[58::2::%p1%{65536}%/%d::%p1%{256}%/%{255}%&%d::%p1%{255}%&%d%;m'  # underscore colours - needs tmux-3.0
# # ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ©ã‚¤ãƒ³ã®è‰²ã‚’å¤‰æ›´
# setw -g status-style fg=colour255,bg=colour234
#
#
# # status-leftã‚’éè¡¨ç¤ºã«ã™ã‚‹
# set -g status-left ""
# # status-rightã‚’éè¡¨ç¤ºã«ã™ã‚‹
# set -g status-right ""
# # window-statusã‚’å³å¯„ã›ã«ã™ã‚‹
# set -g status-justify right
#
# # windowã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’1ã‹ã‚‰å§‹ã‚ã‚‹
# set -g base-index 1
#
# # window-statusã®è¦‹ãŸç›®ã‚’å¤‰æ›´
# # setw -g window-status-current-format '#[bg=colour2,fg=colour255] #I #W #T'
# setw -g window-status-format '#[fg=colour242] #I #{}#W '
# setw -g window-status-current-format '#[fg=#002b36,bg=#eee8d5]î‚°#[fg=#6EA78E,bg=#eee8d5] #I #[fg=#eee8d5,bg=#6EA78E]î‚° #W #[fg=#6EA78E,bg=#002b36,nobold]î‚°'
# # ãƒã‚¦ã‚¹æ“ä½œã‚’æœ‰åŠ¹ã«ã™ã‚‹
# set-option -g mouse on
#
# # prefix+r ã§è¨­å®šã®ãƒªãƒ­ãƒ¼ãƒ‰
# # bind r source-file ~/.tmux.conf \; display "Reloaded!"
#
# set -g mode-style "fg=#eee8d5,bg=#073642"
#
# set -g message-style "fg=#eee8d5,bg=#073642"
# set -g message-command-style "fg=#eee8d5,bg=#073642"
#
# # set -g pane-border-format " [ ###P #T ] "
# set -g pane-border-style "fg=#073642"
# set -g pane-active-border-style "fg=#eee8d5"
#
# set -g status "on"
# set -g status-interval 1
# set -g status-justify "left"
#
# set -g status-style "fg=#586e75,bg=#073642"
#
# set -g status-bg "#003b36"
#
# set -g status-left-length "100"
# set -g status-right-length "100"
#
# set -g status-left-style NONE
# set -g status-right-style NONE
# # set -g @PATH $(tmux display-message -p "#{pane_current_path}")
# set -g @PATH $(pwd)
# set -g status-right "#{@PATH}"
#
# set -g status-left "#[fg=#073642,bg=#eee8d5,bold] #S #[fg=#eee8d5,bg=#7BBEF7,nobold,nounderscore,noitalics]î‚°#[fg=#15161E,bg=#7BBEF7,bold] #(whoami) #[fg=#7BBEF7,bg=#002b36]î‚°"
# set -g status-right "#[fg=#586e75,bg=#002b36,nobold,nounderscore,noitalics]î‚²#[fg=#93a1a1,bg=#586e75] #{prefix_highlight} #{?window_zoomed_flag,#[fg=red]Zoomed#[default],Not Zoomed}#[fg=#657b83,bg=#586e75,nobold,nounderscore,noitalics]î‚²#[fg=#93a1a1,bg=#657b83] #[fg=#BAC3C3,bg=#657b83,nobold,nounderscore,noitalics]#{?client_prefix,#[fg=#82EA94],}î‚²#[fg=#15161E,bg=#BAC3C3,bold]#{?client_prefix,#[bg=#82EA94],} #(echo #{pane_current_path} | sed 's#$HOME#~#g') "
#
# setw -g window-status-activity-style "underscore,fg=#839496,bg=#002b36"
# setw -g window-status-separator ""
# setw -g window-status-style "NONE,fg=#839496,bg=#002b36"
# # setw -g window-status-format '#[fg=#002b36,bg=#002b36]î‚°#[default] #I î‚± #{b:pane_current_path} #[fg=#002b36,bg=#002b36,nobold,nounderscore,noitalics]î‚°'
# set-option -g automatic-rename on
# set-option -g automatic-rename-format '#(basename "#{pane_current_path}")'
# # Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
# run '~/.tmux/plugins/tpm/tpm'


# undercurlè¡¨ç¤ºå¯¾å¿œ
set-option -g default-terminal "screen-256color"

set -ag terminal-overrides ",xterm-256color:Tc"
# set-option -g terminal-overrides ',xterm-256color:RGB'
set-option -g focus-events on # TODO: learn how this works

set -g prefix ^S
set -g base-index 1          # start indexing windows at 1 instead of 0
set -g detach-on-destroy off # don't exit from tmux when closing a session
set -g escape-time 0         # zero-out escape time delay
set -g history-limit 1000000 # increase history size (from 2,000)
set -g mouse on              # enable mouse support
set -g renumber-windows on   # renumber all windows when any window is closed
set -g set-clipboard on      # use system clipboard
set -g status-interval 3     # update the status bar every 3 seconds

# set -g status-left "#[fg=#073642,bg=#eee8d5,bold] #S #[fg=#eee8d5,bg=#7BBEF7,nobold,nounderscore,noitalics]î‚°#[fg=#15161E,bg=#7BBEF7,bold] #(whoami) #[fg=#7BBEF7,bg=#002b36]î‚°"
# set -g status-right "#[fg=#586e75,bg=#002b36,nobold,nounderscore,noitalics]î‚²#[fg=#93a1a1,bg=#586e75] #{prefix_highlight} #{?window_zoomed_flag,#[fg=red]Zoomed#[default],Not Zoomed}#[fg=#657b83,bg=#586e75,nobold,nounderscore,noitalics]î‚²#[fg=#93a1a1,bg=#657b83] #[fg=#BAC3C3,bg=#657b83,nobold,nounderscore,noitalics]#{?client_prefix,#[fg=#82EA94],}î‚²#[fg=#15161E,bg=#BAC3C3,bold]#{?client_prefix,#[bg=#82EA94],} #(echo #{pane_current_path} | sed 's#$HOME#~#g') "
# set -g status-left "#[fg=blue,bold,bg=#1e1e2e]ïˆ™  #S ï‘„ "
# set -g status-right "#[fg=#b4befe,bold,bg=#1e1e2e]%a %Y-%m-%d ó±‘’ %l:%M %p"

# set -ga status-right "#($HOME/.config/tmux/scripts/cal.sh)"
set -g status-justify left
set -g status-left-length 200    # increase length (from 10)
set -g status-right-length 200    # increase length (from 10)
set -g status-position top       # macOS / darwin style
# set -g status-position bottom       # macOS / darwin style
set -g status-style 'bg=#1e1e2e' # transparen#

# set -g window-status-current-format '#[fg=magenta,bg=#1e1e2e]*#Iï‘„ #W#{?window_zoomed_flag,(î®),} '
# setw -g window-status-current-format '#[fg=#002b36,bg=#eee8d5]î‚°#[fg=#6EA78E,bg=#eee8d5] #I #[fg=#eee8d5,bg=#6EA78E]î‚° #W #[fg=#6EA78E,bg=#002b36,nobold]î‚°'

set -g window-status-format '#[fg=gray,bg=#1e1e2e] #Iï‘„ #W'
set -g window-status-last-style 'fg=white,bg=black'
set -g default-terminal "${TERM}"
set -g message-command-style bg=default,fg=yellow
set -g message-style bg=default,fg=yellow
set -g mode-style bg=default,fg=yellow
setw -g mode-keys vi
set -g pane-active-border-style 'fg=magenta,bg=default'
set -g pane-border-style 'fg=brightblack,bg=default'

set -g @fzf-url-fzf-options '-p 60%,30% --prompt="ï‚   " --border-label=" Open URL "'
set -g @fzf-url-history-limit '2000'
set -g @t-bind ","
set -g @t-fzf-default-results 'sessions'
set -g @t-fzf-find-binding 'ctrl-l:change-prompt(ï¼  )+reload(fd -H -d 2 -t d -E .Trash . ~)'
set -g @t-fzf-prompt 'î¯ˆ  '
set -g @tmux-last-color on
set -g @tmux-last-pager 'nvim -'
set -g @tmux-last-prompt-pattern 'ï” '
set -g @tmux-nerd-font-window-name-shell-icon 'ï”'
set -g @tmux-nerd-font-window-name-show-name false

bind r source-file ~/.tmux.conf \; display "Reloaded!"
# bind-key r rotate-window
bind-key R rotate-window -D
bind v split-window -h
bind s split-window -v
bind o select-pane -t :.+
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R
bind -n C-M-z resize-pane -Z
unbind C-z
bind a setw synchronize-panes \; display "synchronize-panes #{?pane_synchronized,on,off}"


bind ] run-shell "filepath=/tmp/tmux-buffer/$(date +'%Y-%m-%d_%H-%M-%S'); mkdir -p $(dirname \$filepath) && tmux capture-pane -pS - > \$filepath && tmux display-message \"Pane captured to \$filepath\""


# ------------------------------------------------------------------------------------------
#  window management
# ------------------------------------------------------------------------------------------

bind -n C-M-c new-window

bind -n C-M-n next-window
bind -n C-M-p previous-window

bind -n C-M-r rotate-window 

bind -n C-M-v split-window -h
bind -n C-M-s split-window -v

# ------------------------------------------------------------------------------------------
#  pane management
# ------------------------------------------------------------------------------------------

bind -n C-M-h select-pane -L
bind -n C-M-j select-pane -D
bind -n C-M-k select-pane -U
bind -n C-M-l select-pane -R

# move pane to the far right/left/bottom/top
bind H splitw -fhb \; swapp -t ! \; killp -t !
#              â”‚â”‚â”‚    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”œâ”€â”€â”€â”€â”€â”€â”€â”˜
#              â”‚â”‚â”‚    â”‚             â”” kill the previous pane
#              â”‚â”‚â”‚    â”” exchange the previous original pane with the current one
#              â”‚â”‚â”” the new pane should be created to the left of or above target-pane
#              â”‚â”” full window height
#              â”” creates a new pane spanning the full window height (with -h)
#                or full window width (with -v), instead of splitting the active pane
bind L splitw -fh  \; swapp -t ! \; killp -t !
bind J splitw -fv  \; swapp -t ! \; killp -t !
bind K splitw -fvb \; swapp -t ! \; killp -t !


bind -n C-M-y resize-pane -L 18
bind -n C-M-u resize-pane -D 12
bind -n C-M-i resize-pane -U 12
bind -n C-M-o resize-pane -R 18
bind -n C-M-m resize-pane -Z
# ãƒšã‚¤ãƒ³ã‚’ãƒªã‚µã‚¤ã‚ºã™ã‚‹
# bind -r y resize-pane -L 19
# bind -r u resize-pane -D 1j
# bind -r i resize-pane -U 13
# bind -r o resize-pane -R 18

# NOTE: <prefix> + I to install plugins
# Plugin manager
set -g @plugin 'tmux-plugins/tpm'

# extract text from the terminal
set -g @plugin 'laktak/extrakto'
# set -g @extrakto_popup_size '90,20'

# yank like a easy-motion
# FIXME: not working
set -g @plugin 'fcsonline/tmux-thumbs'

# like a Vscode Ctrl+P
set -g @plugin 'sainnhe/tmux-fzf'
TMUX_FZF_LAUNCH_KEY="C-p"

set -g @plugin 'joshmedeski/tmux-nerd-font-window-name'
set -g @plugin 'mskelton/tmux-last' # <prefix>t

# A set of tmux options that should be acceptable to everyone.
set -g @plugin 'tmux-plugins/tmux-sensible'

# Session management
set -g @plugin 'omerxx/tmux-sessionx'

# session management
set -g @plugin 'sturob/tmux-teleport'

set -g @sessionx-bind 'e'

# Theme
set -g @plugin 'catppuccin/tmux'
set -g @catppuccin_flavour 'macchiato' # latte, frappe, macchiato, mocha
set -g @catppuccin_window_left_separator "â–ˆ"
set -g @catppuccin_window_right_separator "î‚´Â "
set -g @catppuccin_window_middle_separator "â–ˆ "

# yank to system clipboard
set -g @plugin 'tmux-plugins/tmux-yank'

# easy-motion
set -g @plugin 'IngoMeyer441/tmux-easy-motion'
set -g @easy-motion-prefix "Space"
set -g @easy-motion-auto-begin-selection "true"


set -g @plugin 'ddzero2c/tmux-easymotion'

bind-key -T copy-mode-vi C-v send-keys -X begin-selection \; send-keys -X rectangle-toggle;
bind-key -T copy-mode-vi v send-keys -X begin-selection;
bind-key -T copy-mode-vi V send-keys -X select-line;

# Removed Plugins
# I wanan not use vim keybind at tmux
# set -g @plugin 'christoomey/vim-tmux-navigator'
# Replaced by tmux-sessionx
# set -g @plugin 'joshmedeski/t-smart-tmux-session-manager'
# set -g @plugin 'tmux-plugins/tmux-yank'

run '~/.tmux/plugins/tpm/tpm'

bind -n C-M-t run-shell "sesh connect \"$(
  sesh list --icons | fzf-tmux -p 80%,70% \
    --no-sort --ansi --border-label ' sesh ' --prompt 'âš¡  ' \
    --header '  ^a all ^t tmux ^g configs ^x zoxide ^d tmux kill ^f find' \
    --bind 'tab:down,btab:up' \
    --bind 'ctrl-a:change-prompt(âš¡  )+reload(sesh list --icons)' \
    --bind 'ctrl-t:change-prompt(ğŸªŸ  )+reload(sesh list -t --icons)' \
    --bind 'ctrl-g:change-prompt(âš™ï¸  )+reload(sesh list -c --icons)' \
    --bind 'ctrl-x:change-prompt(ğŸ“  )+reload(sesh list -z --icons)' \
    --bind 'ctrl-f:change-prompt(ğŸ”  )+reload(fd -H -d 2 -t d -E .Trash . ~)' \
    --bind 'ctrl-d:execute(tmux kill-session -t {2..})+change-prompt(âš¡  )+reload(sesh list --icons)' \
    --preview-window 'right:55%' \
    --preview 'sesh preview {}'
)\""
